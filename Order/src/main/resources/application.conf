server {
  port = 8082
  port = ${?SERVER_PORT}

  netty {
    boss-threads = 1
    worker-threads = 16
    worker-threads = ${?NETTY_WORKER_THREADS}
  }

  blocking-pool {
    threads = 64
    threads = ${?BLOCKING_POOL_THREADS}
    queue-size = 2000
    queue-size = ${?BLOCKING_POOL_QUEUE_SIZE}
  }
}

database {
  host = "localhost"
  host = ${?DB_HOST}
  port = 5432
  port = ${?DB_PORT}
  name = "trading"
  name = ${?DB_NAME}
  user = "trading_user"
  user = ${?DB_USER}
  password = "trading_password"
  password = ${?DB_PASSWORD}

  hikari {
    maximum-pool-size = 128
    maximum-pool-size = ${?DB_POOL_SIZE}
    minimum-idle = 64
    minimum-idle = ${?DB_POOL_MIN_IDLE}
    connection-timeout = 30000
    idle-timeout = 600000
    max-lifetime = 1800000
  }
}

redis {
  host = "localhost"
  host = ${?REDIS_HOST}
  port = 6379
  port = ${?REDIS_PORT}
  password = null
  password = ${?REDIS_PASSWORD}
  database = 0
  database = ${?REDIS_DATABASE}
}

account-service {
  host = "localhost"
  host = ${?ACCOUNT_SERVICE_HOST}
  port = 8081
  port = ${?ACCOUNT_SERVICE_PORT}
}

order {
  id {
    # 마이그레이션 기준 시각 (이전은 구 포맷, 이후는 신 포맷)
    # 형식: ISO-8601 (예: 2025-01-15T00:00:00Z)
    migration-cutoff = "2025-01-15T00:00:00Z"
    migration-cutoff = ${?ORDER_ID_MIGRATION_CUTOFF}
  }
}

order-executor {
  # ORDER 샤딩 활성화 (초기 배포 시 false, 점진적 rollout)
  enabled = true
  enabled = ${?ORDER_EXECUTOR_ENABLED}

  # Canary 배포용 트래픽 비율 (0~100)
  canary-percent = 100
  canary-percent = ${?ORDER_EXECUTOR_CANARY_PERCENT}

  # 논리 샤드 개수 (고정 - orderId 포맷)
  logical-shards = 16

  # 샤드당 sub-worker 개수 (조정 가능)
  sub-workers = 4
  sub-workers = ${?ORDER_EXECUTOR_SUB_WORKERS}
}

metrics {
  # Prometheus HTTP endpoint 포트
  port = 9094
  port = ${?METRICS_PORT}
}
